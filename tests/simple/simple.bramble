load("github.com/maxmcd/bramble/lib/seed", "seed")
load("github.com/maxmcd/bramble/lib/stdenv", "gcc", "build_inputs")
load("github.com/maxmcd/bramble/lib/std", "exec", "fetch_url")


def simple():
    s = seed()
    return derivation(
        name="simple",
        builder=s.out + "/bin/sh",
        env={"seed": s},
        args=["./simple_builder.sh"],
        sources=["./simple.c", "simple_builder.sh"],
    )


def run_simple():
    s = simple()
    exec(os.session(), s.out + "/simple")


def simple2():
    s = seed()
    return derivation(
        builder=_simple2,
        sources=["./simple.c", "simple_builder.sh"],
        env={"stdenv": build_inputs()[0]},
    )


def _simple2(s, outputs):
    gcc("-o", outputs["out"] + "/simple", "./simple.c")
    exec(s, outputs["out"] + "/simple")
