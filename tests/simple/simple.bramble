load("github.com/maxmcd/bramble/lib/seed")
load("github.com/maxmcd/bramble/lib/stdenv")
load("github.com/maxmcd/bramble/lib/std")


def simple():
    s = seed.seed()
    return derivation(
        name="simple",
        builder=s.out + "/bin/sh",
        env={"seed": s},
        args=["./simple_builder.sh"],
        sources=["./simple.c", "simple_builder.sh"],
    )


def run_simple():
    s = simple()
    std.exec(os.session(), s.out + "/simple")


def simple2():
    s = seed.seed()
    return derivation(
        builder=_simple2,
        sources=["./simple.c", "simple_builder.sh"],
        env={"stdenv": stdenv.build_inputs()[0]},
    )


def _simple2(s, outputs):
    stdenv.gcc(s, "-o", outputs["out"] + "/simple", "./simple.c")
    std.exec(s, outputs["out"] + "/simple")
